

<!DOCTYPE html>
<head>
    <title>Pusher Test</title>
    <script src="https://js.pusher.com/7.1/pusher.min.js"></script>
    <script>

        // Enable pusher logging - don't include this in production
       // Pusher.logToConsole = true;

        Pusher.log = (msg) => {
            var myARR=JSON.parse(msg);
            for(var i=0;i<myARR.length();i++){
                try{
                    var thisJSON=JSON.parse(myARR[i]);
                    if(thisJSON.hasOwnProperty("user")){
                        console.log("USER FOUND NOW : "+thisJSON["user"]);
                    }

                }
                catch(e){
                    console.log(myARR[i]);
                }

            }


        };
        var channelName ='private-ishopper';
        var eventName="pusher:subscription_succeeded";


        var pusher = new Pusher('6ad64e86fc885ee2bb0a', {
        /* userAuthentication: {
             endpoint: "http://192.168.0.50:3000/pusher/auth",
               // endpoint: "localhost:3000/pusher/user-auth",
                 transport: "ajax",
                params: {},
                headers: {},
                 customHandler: null,
           //     transport: "jsonp",

            },*/
           //authEndpoint: 'http://192.168.0.50:3000/pusher/auth',
          //  userAuthentication: { endpoint: "/pusher_user_auth.php"},
            channelAuthorization: {
                endpoint: "/pusher/user-auth",
            },
            encrypted: false, // local only
          //  forceTLS: true,
            cluster: 'ap1',
          enabledTransports: ['ws', 'xhr_streaming'],
         //   disabledTransports: ['xhr_streaming']
        });

        var channel = pusher.subscribe(channelName);

/*
        //  channel = pusher.channel(channelName);


        channel.bind('user-connect', function(data) {
            console.log(JSON.stringify(data));
        });
		channel.bind('pusher:subscription_succeeded', function(data) {
            console.log(JSON.stringify(data));


        });
        pusher.connection.bind("state_change", function (states) {
            // states = {previous: 'oldState', current: 'newState'}
          //  $("div#status").text("Channels current state is " + states.current);

            console.log(JSON.stringify(states));


        });
*/

          channel = pusher.channel(channelName);
        pusher.allChannels().forEach(channel => console.log(channel.name));

        pusher.signin();

        var callback = (data) => {
            // add comment into page
            console.log(JSON.stringify(data));
        };

        pusher.bind(eventName, callback);
    </script>
</head>
<body>
<h1>Pusher Test</h1>
<p>
    Try publishing an event to channel <code>my-channel</code>
    with event name <code>my-event</code>.
</p>
</body>

